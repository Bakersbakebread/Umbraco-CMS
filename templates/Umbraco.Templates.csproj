<Project Sdk="Microsoft.NET.Sdk">
  <PropertyGroup>
    <Title>Umbraco CMS - Templates</Title>
    <Description>Coontains templates for Umbraco CMS.</Description>
    <PackageType>Template</PackageType>
    <IncludeBuildOutput>false</IncludeBuildOutput>
    <IncludeSymbols>false</IncludeSymbols>
    <NoDefaultExcludes>true</NoDefaultExcludes>
    <IncludeContentInPack>true</IncludeContentInPack>
    <ContentTargetFolders>.</ContentTargetFolders>
    <NoWarn>NU5128</NoWarn>
  </PropertyGroup>

  <ItemGroup>
    <Content Include="UmbracoPackage\**" Exclude="bin;obj" />
    <Content Include="UmbracoProject\**" Exclude="bin;obj" />
    <Content Include="..\src\Umbraco.Web.UI\Program.cs">
      <Link>UmbracoProject\Program.cs</Link>
      <PackagePath>UmbracoProject</PackagePath>
    </Content>
    <Content Include="..\src\Umbraco.Web.UI\Startup.cs">
      <Link>UmbracoProject\Startup.cs</Link>
      <PackagePath>UmbracoProject</PackagePath>
    </Content>
    <Content Include="..\src\Umbraco.Web.UI\Views\Partials\blocklist\**">
      <Link>UmbracoProject\Views\Partials\blocklist\%(RecursiveDir)%(Filename)%(Extension)</Link>
      <PackagePath>UmbracoProject\Views\Partials\blocklist</PackagePath>
    </Content>
    <Content Include="..\src\Umbraco.Web.UI\Views\Partials\grid\**">
      <Link>UmbracoProject\Views\Partials\grid\%(RecursiveDir)%(Filename)%(Extension)</Link>
      <PackagePath>UmbracoProject\Views\Partials\grid</PackagePath>
    </Content>
    <Content Include="..\src\Umbraco.Web.UI\Views\Partials\blockgrid\**">
      <Link>UmbracoProject\Views\Partials\blockgrid\%(RecursiveDir)%(Filename)%(Extension)</Link>
      <PackagePath>UmbracoProject\Views\Partials\blockgrid</PackagePath>
    </Content>
    <Content Include="..\src\Umbraco.Web.UI\Views\_ViewImports.cshtml">
      <Link>UmbracoProject\Views\_ViewImports.cshtml</Link>
      <PackagePath>UmbracoProject\Views</PackagePath>
    </Content>
    <Content Include="..\src\Umbraco.Web.UI\wwwroot\favicon.ico">
      <Link>UmbracoProject\wwwroot\favicon.ico</Link>
      <PackagePath>UmbracoProject\wwwroot</PackagePath>
    </Content>
  </ItemGroup>

  <!-- Transform template.json files with the default UmbracoVersion value set to the current build version -->
  <ItemGroup>
    <PackageReference Include="Microsoft.VisualStudio.SlowCheetah" Version="4.0.8" PrivateAssets="all" />
  </ItemGroup>
  <Target Name="GetTransformedTemplateJsonPackageFiles" BeforeTargets="_GetPackageFiles">
    <WriteLinesToFile File="$(IntermediateOutputPath)template.json" Lines="{&quot;symbols&quot;:{&quot;UmbracoVersion&quot;:{&quot;defaultValue&quot;:&quot;$(PackageVersion)&quot;}}}" Overwrite="true" />
    <ItemGroup>
      <_TemplateJsonFiles Include="**\.template.config\template.json" Exclude="bin\**;obj\**" />
    </ItemGroup>
    <MakeDir Directories="@(_TemplateJsonFiles->'$(IntermediateOutputPath)%(RelativeDir)')" />
    <SlowCheetah.TransformTask Source="@(_TemplateJsonFiles)" Transform="$(IntermediateOutputPath)template.json" Destination="$(IntermediateOutputPath)%(RelativeDir)%(Filename)%(Extension)" />
    <ItemGroup>
      <_PackageFiles Include="@(_TemplateJsonFiles->'$(IntermediateOutputPath)%(RelativeDir)%(Filename)%(Extension)')">
        <PackagePath>%(RelativeDir)</PackagePath>
      </_PackageFiles>
    </ItemGroup>
  </Target>
</Project>
